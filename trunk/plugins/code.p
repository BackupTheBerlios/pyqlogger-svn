class CodePasterPlugin (ToolbarPlugin):
    image = \
    "\x89\x50\x4e\x47\x0d\x0a\x1a\x0a\x00\x00\x00\x0d" \
    "\x49\x48\x44\x52\x00\x00\x00\x16\x00\x00\x00\x16" \
    "\x08\x06\x00\x00\x00\xc4\xb4\x6c\x3b\x00\x00\x02" \
    "\x5d\x49\x44\x41\x54\x38\x8d\xd5\x93\xa1\x72\xdb" \
    "\x40\x10\x86\x3f\x67\x0a\x56\xec\xc4\x22\x78\xd0" \
    "\x65\x36\x93\xa0\xc2\x1c\x68\xd6\xc2\xe6\x0d\xf2" \
    "\x1a\x81\x81\x11\x34\x94\x99\xc2\x54\xa8\x32\x9b" \
    "\x55\xf0\xe0\x89\xdd\xb1\x5b\xa6\x02\xb7\x9d\x66" \
    "\x92\xd6\x99\xb6\xd3\x99\xfe\xe8\x6e\x67\xe7\xdb" \
    "\x7f\x77\xef\xe0\x7f\xd3\xe2\xc7\x4b\xd7\x75\xb3" \
    "\x73\x0e\xef\x3d\x51\x15\x00\x23\x82\xb5\x16\x6b" \
    "\x2d\x57\x57\x57\x8b\x17\x29\xbf\x02\xb7\x6d\x3b" \
    "\x0f\x87\x03\xb9\x2d\x58\xae\xd7\x60\x04\x00\xef" \
    "\x1c\xe3\xc7\x03\x06\xa8\xaa\x8a\xeb\xeb\xeb\x57" \
    "\xc1\x17\xdf\xa0\x6d\xdb\x52\x5d\xd7\x54\xef\xb6" \
    "\x00\xa8\x2a\x49\x13\x8a\x12\x35\x32\xec\x3a\xc4" \
    "\x2b\x9b\xcd\xe6\x55\xce\x2f\xfa\xbe\x9f\x87\xc3" \
    "\x40\xfd\xe1\x3d\xcb\x4d\x8d\xaa\xa2\x4e\x48\xee" \
    "\x12\xc6\x82\x38\x08\xc1\x07\x96\x9b\x1a\x8a\x9c" \
    "\xe3\xf1\xf8\xaa\x51\x5c\x38\xe7\xc8\xad\xa5\xaa" \
    "\x6b\x00\xc4\x5f\x12\x9c\x67\xd2\x23\x93\x8c\x88" \
    "\xe6\xc8\x60\xd1\x18\xb1\xd5\x92\xd1\x39\xba\xae" \
    "\x9b\xcf\x83\xa7\x89\x65\xb5\x46\x51\x34\x80\x1b" \
    "\x1d\x2e\x1f\x49\x45\xc0\xe3\x50\x09\x64\x08\xea" \
    "\x15\x44\x90\xc2\xe0\xbd\x3f\xef\x58\x53\xc2\xe4" \
    "\x86\xa0\x01\x9f\x4d\x84\xf5\x84\x18\x41\x83\x62" \
    "\xb0\x40\x8e\x8b\x23\xc9\x24\x50\x10\x93\x31\x4d" \
    "\xd3\x59\xf0\x1b\x80\x98\x14\x11\x20\x25\x14\x40" \
    "\x15\xf1\x96\x4c\x0b\xbc\x1b\x48\x4b\x07\xe4\x68" \
    "\x88\x80\xc0\x29\xeb\xd7\x8e\x41\x41\xf5\xb4\x34" \
    "\xfd\x76\x86\x4c\x05\x3f\x1e\x08\x4b\x0f\x85\x80" \
    "\x26\x54\x40\x63\x40\x44\xce\x83\x8b\xbc\xc0\x39" \
    "\x87\xa6\x13\x50\xa3\xa2\x28\x5e\x1d\x5a\x44\x14" \
    "\xd0\x70\x8a\xa5\x98\x08\x21\x62\xad\x3d\x0f\xb6" \
    "\xd6\xe2\x87\xcf\xa4\x98\x50\x8d\x27\x40\x50\x44" \
    "\x73\x70\x42\x8c\x91\xaf\x8d\x10\xfd\x44\x81\x60" \
    "\x8c\x39\x0b\x5e\x00\xdc\xdd\xdd\xcd\x8e\x80\xa9" \
    "\xde\x42\x02\x48\xe8\x04\x84\x08\x56\xf0\x3e\x02" \
    "\x90\x7d\x72\x94\x65\xc9\xba\x5a\xe3\x46\x87\x31" \
    "\xe6\xa7\x9f\xe5\x02\x60\xb5\x5a\x61\x02\xc4\xee" \
    "\x40\xa6\x89\x4c\x33\xf2\xcb\x0c\xb1\x06\x51\x28" \
    "\x14\xf8\xf8\x99\xb2\x2c\xb9\xb9\xb9\x59\xb8\xd1" \
    "\xf1\xf8\xf8\x48\xd3\x34\xb4\x6d\xfb\xe2\x9b\xfe" \
    "\x5e\xad\xef\xfb\xf9\x78\x3c\x32\x3a\x87\x18\x81" \
    "\xec\xb4\x20\x0d\x11\x51\xa8\xeb\x9a\xed\x76\xbb" \
    "\x00\x18\x86\x61\xee\xba\x8e\xfd\x7e\x8f\x31\x86" \
    "\xed\x76\xcb\x6a\xb5\x7a\xe2\xfe\x59\x1b\x5d\xd7" \
    "\xcd\xde\x7b\x62\x8c\x88\x08\x79\x9e\x63\xad\xa5" \
    "\xaa\xaa\x67\xb9\xbb\xdd\x6e\x6e\x9a\x06\xef\x3d" \
    "\x75\x5d\x3f\x29\xfe\xc7\xea\xfb\x7e\xbe\xbd\xbd" \
    "\x9d\xad\xb5\x73\x59\x96\xf3\xfd\xfd\xfd\xfc\xa2" \
    "\xe3\xdf\xd5\xc3\xc3\xc3\xdc\x34\x0d\xd3\x34\xb1" \
    "\xd9\x6c\xfe\x1e\x18\x4e\x63\xdc\xef\xf7\xa4\x94" \
    "\xfe\x26\xf6\x1f\xe9\x0b\xbc\x4c\x5e\x59\xd6\x14" \
    "\xca\xf4\x00\x00\x00\x00\x49\x45\x4e\x44\xae\x42" \
    "\x60\x82"
    
    def defaultOptions(self):
        
        return [ Option(Type="List",
                        Name="Theme",
                        Value="0;html;html-dark;html-fntlck;html-light;html-nobg;html-nocolor;html-simple"),
                 Option(Type="String",
                        Name="Code2Html path",
                        Value="/usr/share/pyqlogger/code2html.pl"),
                 Option( Type="Boolean", Name="Line Numbers"),
                 Option( Type="Boolean", Name="Link Numbers"),
                 Option( Type="Boolean", Name="Replace Tabs"),
                 Option( Type="Integer", Name="Tab Size",Value="4"),
                 Option( Type="Boolean", Name="Break lines"),
                 Option( Type="Integer", Name="Max chars per line",Value="80"),
               ]
    
    def on_click (self):
        import os
        filename = QFileDialog.getOpenFileName(os.path.expanduser("~"),
                                    "All files (*.*)",self.parent,           
                                    "Files with code",
                                    "Choose a filename to open")
        if str(filename):
            opt = self.Data.optionByName("Code2Html path")
            params = ["perl", opt.Value , str(filename) ]
            opt = self.Data.optionByName("Theme")
            params += [ "-o %s" % opt.getListOptionValue() ]
            opt = self.Data.optionByName("Line Numbers")
            if opt.Value:
                params += [ "-n"]
            opt = self.Data.optionByName("Link Numbers")
            if opt.Value:
                params += [ "-N"]
            opt = self.Data.optionByName("Replace Tabs")
            if opt.Value:
                opt = self.Data.optionByName("Tab Size")
                params += [ "--replace-tabs=" + opt.Value ]
            opt = self.Data.optionByName("Break lines")
            if opt.Value:
                opt = self.Data.optionByName("Max chars per line")
                params += [ "--linewidth=" + opt.Value ]

            import commands
            print "running :"+" ".join(params)
            out = commands.getoutput(" ".join(params))
            sourceEditor = self.parent.sourceEditor
            line, index = sourceEditor.getCursorPosition()
            sourceEditor.insertAt(out, line, index)
            
    Name = "Source Code Paster"
    
    def getWidget(self, parent):
        self.parent = parent
        page = self.parent.getPage("Plugins")
        button = QPushButton(page)
        bi = QPixmap()
        bi.loadFromData(self.image,"PNG")
        button.setIconSet(QIconSet(bi))
        w = 32
        h = 32
        button.setMaximumSize(QSize(w,h))
        QToolTip.add(button,self.Name)
        self.parent.connect(button,SIGNAL("clicked()"),self.on_click)
        button.hide()
        self.button = button
        return button


